\chapter{Contexto}\label{chap:2contexto}

En esta sección se intentarán poner en perspectiva, de una forma no exhaustiva, las distintas razones
históricas que dan lugar a la necesidad de crear un sistema de almacenamiento descentralizado y distribuido como IPFS.
Para ello, se hará un breve repaso histórico de la evolución de Internet y de los protocolos que lo han ido conformando.
Posteriormente, se explicará la tendencia centralista del sistema actual, existente a un nivel intrínseco y estructural,
además de otros problemas que se derivan de esta situación.
Finalmente, se expondrá la propuesta de solución que IPFS ofrece para solventar estos problemas, sobre la que se profundizará en la sección \ref{sect:ipfs}: '\nameref{sect:ipfs}'.

\section{Breve historia de Internet}
\subsection{Predominancia de los protocolos TCP/IP}
La historia de internet está marcada por la competencia entre distintos protocolos de comunicación que buscaban establecerse
como el estándar para intercambiar información entre diferentes redes y sistemas. Uno de los episodios más relevantes de esta
competencia fue la llamada \textit{"Guerra de los protocolos"} \cite{ProtocolWars2023}, en la que el conjunto de protocolos TCP/IP, creado entre los
años 1973 y 1974 por Vint Cerf y Robert Kah, se enfrentó a otras propuestas como OSI, X.25 o SNA\footnote{En la figura \ref{tab:comparacion-protocolos-90} de la página \pageref{tab:comparacion-protocolos-90} se muestra un resumen de las principales características de cada uno de estos protocolos.
}.

TCP/IP logró imponerse a la competencia debido a las siguientes características principalmente:
\begin{itemize}
      \item \textbf{ Interoperabilidad }: La capacidad de TCP/IP para conectarse fácilmente con diferentes tipos de ordenadores y sistemas operativos le otorgaba una ventaja sobre otros protocolos que eran más específicos o limitados en su compatibilidad. Esta característica permitía que diversas tecnologías y plataformas pudieran comunicarse entre sí sin problemas, lo cual era esencial para crear una red global como internet.

      \item \textbf{ Flexibilidad }: TCP/IP podía adaptarse a distintos medios de transmisión, como cables de cobre, fibra óptica o incluso enlaces inalámbricos, lo que facilitaba su implementación en una amplia variedad de entornos y situaciones. Otros protocolos, en cambio, podrían haber requerido modificaciones o adaptaciones específicas para funcionar en diferentes tipos de medios de transmisión.

      \item \textbf{ Resistencia }frente a fallos: TCP/IP fue diseñado para ser robusto en caso de fallos en la red, permitiendo que los paquetes de datos pudieran ser retransmitidos y encontrar rutas alternativas en caso de problemas. Esta capacidad de recuperación era fundamental para garantizar la continuidad y fiabilidad de las comunicaciones en una red global con múltiples nodos y enlaces.

      \item \textbf{ Escalabilidad }: TCP/IP podía soportar el crecimiento de la red al permitir la incorporación de nuevos nodos y enlaces sin afectar negativamente su rendimiento. Su diseño jerárquico y descentralizado facilitaba la expansión de la red y evitaba los cuellos de botella que podrían haberse producido con otros protocolos menos escalables.

\end{itemize}

Estas ventajas hicieron que TCP/IP se convirtiera en la opción preferida frente a otros protocolos, al ser una solución más versátil,
resistente y escalable para la creciente demanda de interconexión entre sistemas y redes en todo el mundo.
Cabe destacar también que era una solución con arquitectura abierta, no propietaria y de uso gratuito, es decir, sin necesidad de pagar licencias por su uso \cite{edwardsFoundationInternetTCP2021}.

Como en toda guerra también hubo un trasfondo político. Este hecho suele ser ignorado al abordarse este tema desde un punto de vista puramente tecnológico.
Y es que en 1980, el Departamento de Defensa de Estados Unidos declaró TCP/IP como el estándar para todas las redes militares \cite{leinerBriefHistoryInternet1999}.
A esto se sumaron numerosas comunidades de investigación y universidades que adoptaron TCP/IP como su protocolo de comunicación, como por ejemplo, Stanford University, donde Vint Cerf colaboró con Robert Kahn en el diseño del protocolo \cite{leinerBriefHistoryInternet1999}; University of California, Los Angeles (UCLA), que participó en el desarrollo temprano y las pruebas de TCP/IP \cite{leinerBriefHistoryInternet1999}; y University College London (UCL), donde el profesor Peter Kirstein promovió el uso de TCP/IP en Europa y su equipo contribuyó al desarrollo y pruebas del protocolo \cite{moriPeterKirsteinObituary2020}.

\begin{figure}[H]
      \centering
      \includegraphics[width=0.8\textwidth]{images/TimelineOfTheInternetProtocols.png}
      \caption[Evolución de los protocolos de Internet]{Evolución de los protocolos de Internet. Fuente \cite{leinerBriefHistoryInternet1999}}
\end{figure}

Esta completa adopción del protocolo se dió por finalizada cuando ARPANET precursor de
internet y financiado por la Agencia de Proyectos de Investigación Avanzados de Defensa
(DARPA), llevó a cabo la transición exitosa de su antiguo protocolo, el Network Control Program
(NCP), a TCP/IP el 1 de enero de 1983 \cite{leinerBriefHistoryInternet1999}.

En resumen, la rápida adopción de la comunidad científica y académica, sumada al respaldo gubernamental consolidaron TCP/IP como el estándar dominante en la industria de las redes de comunicación.

\subsection{La World Wide Web y HTTP}
El modelo TCP/IP asentó una forma de comunicación estándar entre computadores y redes, aunque
este estaba limitado principalmente al mundo académico y científico. No fue hasta la creación de la World Wide Web (WWW)
cuando el Internet concebido como es en la actualidad se convirtió en un fenómeno global y accesible para todo el mundo.

Antes de la WWW, el acceso a la información en Internet se realizaba a través de los protocolos a nivel de aplicación mostrados en la figura \ref{fig:evolucion-protocolos}

\begin{table}[h]
      \small
      \centering
      \begin{tabular}{>{\raggedright}m{3cm}m{10cm}}
            \toprule
            \textbf{Protocolo}                                   & \textbf{Descripción}                                                                                                                                                \\
            \midrule
            FTP (Protocolo de Transferencia de Archivos)         & Utilizado para transferir archivos entre cliente y servidor a través de una red.                                                                                    \\
            \addlinespace
            Telnet                                               & Basado en texto utilizado para el acceso remoto a computadoras y servidores, permitiendo a los usuarios controlarlos a través de una interfaz de línea de comandos. \\
            \addlinespace
            Gopher                                               & Diseñado para buscar y recuperar documentos de manera jerárquica, utilizando una interfaz basada en menús.                                                          \\
            \addlinespace
            SMTP (Protocolo Simple de Transferencia de Correo)   & Utilizado para enviar mensajes de correo electrónico entre servidores y, finalmente, al cliente de correo del destinatario.                                         \\
            \addlinespace
            NNTP (Protocolo de Transferencia de Noticias en Red) & Utilizado para la distribución, consulta y recuperación de artículos de noticias en la red Usenet.                                                                  \\
            \addlinespace
            POP3 (Protocolo de Oficina de Correos 3)             & Utilizado para recuperar mensajes de correo electrónico desde un servidor de correo remoto hasta un cliente de correo local.                                        \\
            \addlinespace
            IMAP (Protocolo de Acceso a Mensajes de Internet)    & Permite a los usuarios acceder y administrar sus mensajes de correo electrónico en un servidor de correo, sin descargarlos a un cliente de correo local.            \\
            \bottomrule
      \end{tabular}
      \caption{Protocolos de capa de aplicación antes de HTTP}
      \label{fig:evolucion-protocolos}
\end{table}

Estos servicios se encuentran en nivel de aplicación dentro del \textit{stack} TCP/IP, como se muestra en la figura \ref{fig:tcpip}.
Algunos de ellos se siguen usando hoy en día, o tienen su caso de uso (IMAP, POP3, FTP), pero en lo referente a archivos,
ofrecían métodos básicos de navegación y compartición. Carecían de la capacidad de inter-conectar documentos de manera intuitiva y visual.
\footnote{Cabe destacar que en esta época, los documentos eran principalmente texto plano, sin formato, y no existía la posibilidad de incluir imágenes o vídeos.}

\usetikzlibrary{shapes,arrows,positioning, babel}
\begin{figure}[h!]
      \centering
      \begin{tikzpicture}
            % Estilos
            \tikzstyle{layer}=[draw, rectangle, minimum height=1cm, minimum width=5cm, text centered]
            \tikzstyle{app_protocol}=[draw, rectangle, minimum height=0.5cm, minimum width=1.5cm, text centered, fill=blue!10]
            \tikzstyle{arrow}=[->,>=stealth, thick]

            % Nodos
            \node[layer] (application) {Capa de aplicación};
            \node[layer, below=0.5cm of application] (transport) {Capa de transporte};
            \node[layer, below=0.5cm of transport] (network) {Capa de red};
            \node[layer, below=0.5cm of network] (link) {Capa de enlace de datos};

            \node[app_protocol, above=1cm of application.north] (imap) {IMAP};
            \node[app_protocol, left=0.2cm of imap] (pop3) {POP3};
            \node[app_protocol, right=0.2cm of imap] (nntp) {NNTP};
            \node[app_protocol, left=0.2cm of pop3] (smtp) {SMTP};
            \node[app_protocol, right=0.2cm of nntp] (gopher) {Gopher};
            \node[app_protocol, left=0.2cm of smtp] (telnet) {Telnet};
            \node[app_protocol, right=0.2cm of gopher] (ftp) {FTP};

            % Flechas
            \draw[arrow] (imap.south) -- (application.north);
            \draw[arrow] (pop3.south) -- (application.north);
            \draw[arrow] (nntp.south) -- (application.north);
            \draw[arrow] (smtp.south) -- (application.north);
            \draw[arrow] (gopher.south) -- (application.north);
            \draw[arrow] (telnet.south) -- (application.north);
            \draw[arrow] (ftp.south) -- (application.north);
      \end{tikzpicture}
      \caption{Capas del protocolo TCP/IP mostrando algunos protocolos de la capa de aplicación}
      \label{fig:tcpip}
\end{figure}

En 1989, el científico británico Tim Berners-Lee propuso la creación de la WWW, un sistema de información
global que permitiría a los usuarios navegar y acceder a documentos interconectados mediante
enlaces. Estos documentos, conocidos como páginas web, se almacenarían en computadoras conectadas a la red y podrían ser accedidos
a través de un programa especial llamado navegador web, que interpretaría el código de las páginas y mostraría su contenido al usuario.
\\HTML (Hyper Text Markup Language) es el lenguaje que describe estos documentos. Permite enlazar documentos entre sí mediante hipervínculos. Un hipervínculo es una referencia unidireccional en un documento electrónico que entrelaza diferentes documentos o secciones entre sí. Los usuarios tienen la oportunidad de seguir estos enlaces con tan solo un clic en el texto ancla (texto enlazado) para navegar a los documentos o las secciones correspondientes\cite{Hiperenlace2023}.
Aunque es un concepto simple y con el que cualquier persona en la actualidad esta familiarizada este factor dictamina la forma
en la que se usa internet en la actualidad. Los usuarios de internet interactúan con el contenido en internet mediante estos enlaces.
\\La WWW se basó en tres tecnologías clave: HTML, un lenguaje de marcado para crear páginas web; HTTP, un protocolo para solicitar y transferir recursos a través de la web; y URL, un sistema de direcciones para localizar recursos en la web\cite{leinerBriefHistoryInternet1999}. Y es este último el que genera una gran problemática que resuelve IPFS.

URL significa Uniform Resource Locator, que se traduce al español como Localizador Uniforme de Recursos. Es un sistema de direcciones utilizado en la web para localizar de manera única recursos como páginas web, imágenes, videos y otros archivos. Una URL consta de varios componentes, incluyendo el esquema (como "http://" o "https://"), el nombre de dominio (como "www.ejemplo.com"), la ruta del recurso y otros parámetros opcionales.

\setlength{\parskip}{10pt}
Sin embargo, a medida que la web ha crecido en tamaño y complejidad, el enfoque de direccionamiento basado en la ubicación física
de los servidores puede presentar limitaciones. Por ejemplo, si un recurso se encuentra en una URL específica y esa URL cambia o
el servidor deja de estar disponible, el acceso al recurso se verá comprometido.

IPFS aborda este problema mediante el uso de un sistema de direccionamiento basado en el contenido, en lugar de la ubicación. En
IPFS, cada archivo y bloque de datos se identifican mediante su contenido, utilizando una función hash criptográfica. Esto
permite que los archivos y bloques se puedan encontrar y acceder de forma fiable, independientemente de su ubicación física.

Esto permite a IPFS ofrecer una serie de ventajas sobre el sistema de direccionamiento basado en la ubicación de la web
tradicional, como la resistencia a la censura, la persistencia de los datos y la verificabilidad del contenido.
En la siguiente sección se profundizará en estas ventajas y en cómo IPFS las hace posibles.

\section{IPFS como alternativa a HTTP}\label{sect:ipfs}

\subsection{Introducción}
% Briefly introduce the concept of IPFS and its significance in the modern era of the internet.
% Provide a background on why IPFS was created and its aims.
IPFS fue presentado al mundo en 2014 por Juan Benet, en un informe técnico titulado
\textit{IPFS - Content Addressed, Versioned, P2P File System}\cite{benetIPFSContentAddressed2014}.
Benet presenta el concepto de IPFS y su proposición de crear un sistema de archivos
distribuido y descentralizado que permita a los usuarios almacenar y compartir archivos de forma segura y confiable.

Benet es también el fundador de Protocol Labs\cite{ProtocolLabs}, una empresa dedicada a la creación de protocolos de código abierto para la Web3.
IPFS es un proyecto de código abierto y pese a que Protocol Labs está detrás de este, no es el único contribuidor a su desarrollo. Esto es otro
de los puntos fuertes de IPFS, la comunidad que lo rodea. En la sección \ref{sect:ecosistema}: '\nameref{sect:ecosistema}' se profundiza en este aspecto.

En IPFS, cada archivo se identifica de manera única a través de su contenido mediante un hash criptográfico. Esto significa que
cualquier nodo en la red puede actuar como un proveedor de contenido al almacenar y compartir archivos, permitiendo una mayor
disponibilidad y un internet verdaderamente descentralizado. En lugar de depender de un único servidor web para acceder a un
recurso, los usuarios pueden obtener el contenido de cualquier nodo que tenga ese recurso en particular.

Estos identificadores de contenido se conocen como CID (Content Identifier). Dado que un CID es un puntero que señala a un contenido particular, se puede usar un CID en vez de URL en un enlace. De esta manera
se puede acceder a un recurso de manera fiable, independientemente de su ubicación física, mientras haya algún otro nodo de la red que el contenido que buscamos.

\subsection{Fundamentos}\label{sect:fundamentos}
% Describe the key concepts and terminologies involved in IPFS, such as Content-addressed, Peer-to-peer (P2P) network, and Merkle DAG.
% Explain how these concepts work together to make IPFS a decentralized and distributed file system.
IPFS opera a través de tres principios fundamentales que marcan una diferencia significativa con respecto a los sistemas de archivos convencionales: direccionamiento por contenido, red peer-to-peer y el grafo acíclico dirigido de Merkle (Merkle DAG).


\textbf{Direccionamiento por Contenido:} En IPFS, los archivos no se ubican por su dirección sino por su contenido. Cada archivo posee un
identificador único, denominado CID (Content Identifier), generado a partir de un hash criptográfico de su contenido. Esta característica
asegura la inmutabilidad de los archivos, es decir, los archivos no pueden ser alterados sin modificar su CID. Adicionalmente, el
direccionamiento por contenido favorece la deduplicación, dado que archivos con contenido idéntico compartirán el mismo CID, lo que conlleva a
su almacenamiento único dentro de la red.

\begin{figure}[H]
      \begin{minted}[fontsize=\small]{bash}
$ ipfs add somefile # comando para añadir archivos a ipfs a través de la línea de comandos
added QmVtuHo6C7NUonYTYUNbmgGxvSwrTVGXuahJxhxnoSxPpM somefile
      \end{minted}
      \caption{Ejemplo de CID generado por IPFS}
      \label{fig:ipfs-add}
\end{figure}

\textbf{Red Peer-to-Peer:} IPFS se basa en una red descentralizada en la que cada integrante, o nodo, puede interactuar directamente con cualquier otro nodo, sin la necesidad de intermediarios o servidores centrales. Los nodos funcionan tanto como proveedores como consumidores de contenido, guardando y compartiendo fragmentos de archivos con otros nodos. Esta red peer-to-peer hace que el contenido sea más accesible y resistente a la censura, al evitar la existencia de un único punto de fallo o control.
\begin{figure}[H]
      \centering
      \includegraphics[width=\linewidth]{images/centralvsdecentral.png}
      \caption{Red centralizada en comparación con una red descentralizada}
      \label{fig:centralvsdecentral}
\end{figure}

\textbf{Grafo Acíclico Dirigido de Merkle (Merkle DAG):} Los archivos y sus relaciones dentro de IPFS se representan mediante una estructura de datos conocida como Merkle DAG. Un Merkle DAG es un grafo donde cada nodo tiene un identificador único (CID) que se genera a partir de su contenido y el de sus nodos hijos. Los nodos pueden ser hojas o nodos intermedios, dependiendo de si tienen o no nodos hijos. Los nodos hoja contienen datos binarios de los archivos, mientras que los nodos intermedios contienen enlaces a otros nodos. Los nodos intermedios permiten dividir archivos grandes en bloques más pequeños y formar estructuras jerárquicas, como directorios o sistemas de archivos. El Merkle DAG facilita la verificación de integridad y autenticidad de los archivos, dado que cualquier cambio en el contenido o en los enlaces se refleja en el CID del nodo afectado y sus ancestros.

Cada uno de estos conceptos se profundizará dentro del apartado correspondiente a continuación.

\subsection{Arquitectura}
% Describe the core components of IPFS architecture, such as IPFS node, IPFS client, IPFS gateway, and IPFS cluster.
% Explain the role of each component in the IPFS network.
IPFS es un conjunto de protocolos de código abierto que combina múltiples conceptos existentes de redes
peer-to-peer (P2P), datos enlazados y otras áreas para permitir que los participantes intercambien fragmentos de
archivos.

Estos conceptos concretados en protocolos forman distintos niveles de abstracción, cada uno de los cuales se puede utilizar de forma independiente y conforman la arquitectura de IPFS, también conocido como el \textit{stack} de protocolos de IPFS. En la figura \ref{fig:ipfs} se muestra el stack de protocolos de IPFS.

\begin{figure}[H]
      \centering
      \includegraphics[width=\linewidth]{images/ipfs-stack.png}
      \caption{Stack de protocolos IPFS}
      \label{fig:ipfs}
\end{figure}

Como se puede observar, este stack se divide tres grupos según la funcionalidad que brinda cada capa.
Este diseño en capas subdivido en componentes independientes permite que estos pueden ser ampliados o reemplazados
según se necesite. Esta modularidad en el diseño está respaldada por una biblioteca de redes P2P llamada libp2p\cite{WhatLibp2p}.

Libp2p es una suite de protocolos y herramientas modulares que permite la creación de sistemas de red peer-to-peer (P2P). Se encarga de gestionar todas las necesidades de red, como la negociación de protocolos, el enrutamiento, la detección de nodos y la transmisión de datos.

\subsubsection{Capa de red}
En la capa de red encontramos los protocolos de transporte de red mediante los cuales los nodos se pueden comunicar. Estos protocolos provienen de libp2p\cite{labsLibp2pConnectivity} y son los siguientes:
\begin{itemize}[itemsep=1pt,nolistsep]
      \item \textbf{TCP}: proporciona una entrega de datos confiable, ordenada y con control de errores sobre redes IP.
      \item \textbf{UDP}: proporciona una entrega de datos simple, sin conexión y no confiable sobre redes IP.
      \item \textbf{QUIC}: Un protocolo de transporte multiplexado y seguro que se ejecuta sobre UDP, proporcionando flujos confiables, de baja latencia y cifrados.
      \item \textbf{WebSockets}: Un protocolo que permite la comunicación bidireccional entre un navegador web y un servidor sobre TCP.
      \item \textbf{WebRTC}: Un protocolo que permite la comunicación en tiempo real entre navegadores web mediante conexiones peer-to-peer.
\end{itemize}

Debido a esta gran variedad de protocolos de transporte, libp2p proporciona una forma de identificar el transporte que se esté usando mediante
direcciones \textit{multiaddr}.
Los multiaddresses son una forma de representar las direcciones de red como encapsulaciones de protocolos arbitrarios. Estos multiaddresses admiten direccionar
para cualquier protocolo de red. Siguen una sintaxis simple, lo que los hace fáciles de analizar y construir.

En IPFS, se utilizan los multiaddresses para identificar y localizar los nodos en la red. Cada nodo al configurarse por primera vez
genera un par de claves pública y privada. La clave pública se utiliza para crear un identificador único del nodo en la red llamado peerID, que es el hash de su esta clave pública. La clave privada se utiliza para firmar mensajes y autenticar la identidad del nodo. Además, los nodos tienen una o más direcciones de red que combinan protocolos y valores para indicar cómo conectarse a ellos. Por ejemplo, una dirección de red podría ser /ip4/1.2.3.4/tcp/4001/ipfs/QmFoo, lo que significa que el nodo QmFoo está escuchando conexiones TCP en el puerto 4001 utilizando la dirección IP 1.2.3.4.

Los multiaddresses se pueden encapsular entre sí para crear capas de transporte más complejas. Por ejemplo, se puede utilizar /dns4/example.com/tcp/1234/tls/ws/tls para indicar una conexión segura con WebSockets sobre TLS utilizando el dominio example.com y el puerto 1234.

La amplia variedad de protocolos de transporte disponibles garantiza la adaptabilidad de IPFS, ya que los nodos pueden utilizar múltiples protocolos de transporte simultáneamente y cambiar entre ellos según las condiciones de la red. Esto significa que las opciones de transporte de un nodo dependen del entorno en el que se ejecute. Por ejemplo, en un navegador web, solo se pueden utilizar WebSockets y WebRTC, mientras que en otros entornos se pueden utilizar todos los protocolos mencionados anteriormente, siempre que sean compatibles.

\subsubsection{Enrutamiento y descubrimiento de nodos}
\textbf{Descubrimiento de nodos:}
\\El descubrimiento es el proceso de encontrar y anunciar servicios a otros nodos disponibles en una red P2P. Se puede realizar utilizando diversos protocolos,
por ejemplo la difusión de mensajes a todos los nodos de la red o utilizar una serie nodo de arranque para proporcionar una lista de nodos conocidos.

Esto último se conoce como nodos de arranque (bootstrapping). Son nodos predefinidos (por cada nodo) y de confianza que ayudan a los nuevos nodos a unirse a la red y a descubrir otros nodos, facilitando el proceso de construcción y mantenimiento de la red distribuida.

\begin{figure}[H]
      \centering
      \small
      \begin{minted}{json}
"Bootstrap": [
"/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN",
"/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa",
"/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb",
"/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt",
"/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ",
"/ip4/104.131.131.82/udp/4001/quic/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"
],
      \end{minted}
      \caption{Bootstrappers por defecto en una instalación de IPFS}
      \label{}
\end{figure}

\textbf{Enrutamiento}:
\\Por otro lado, enrutamiento se refiere a encontrar la ubicación específica de otro nodo de la red. Esto se realiza
típicamente mediante el mantenimiento de una tabla de enrutamiento u otra estructura de datos similar que realiza un
seguimiento de la topología de la red. En el caso de IPFS se usa una tabla de hash distribuida conocida como DHT (Distributed
hash table).

En la práctica, la distinción entre el enrutamiento y el descubrimiento de nodos no siempre está clara, de hecho suelen ocurrir simultáneamente.

Los protocolos principales\footnote{Existen más protocolos de enrutamiento y descubrimiento de nodos en libp2p pero estos son los más utilizados por IPFS.} que usa IPFS y libp2p para este propósito son:

\begin{itemize}[itemsep=1pt,nolistsep]
      \item \textbf{ping}: Protocolo de comprobación de disponibilidad. Los nodos pueden utilizarlo para verificar la conectividad y el rendimiento entre ellos.
      \item \textbf{autonat}: Protocolo de detección de NAT. Asiste a los nodos en la identificación de su accesibilidad desde internet, esto es útil para detectar si los nodos que se encuentran ocultos detrás de un NAT o de un firewall \cite{AutoNAT}.
      \item \textbf{identify}: Protocolo para el intercambio de claves y direcciones con otros nodos. Facilita el intercambio de información esencial, como los protocolos soportados, las claves públicas, las direcciones, etc.
      \item \textbf{kademlia}: Protocolo para la implementación de una tabla hash distribuida para el almacenamiento descentralizado y la recuperación de información de nodos y contenidos.
      \item \textbf{mdns}: Protocolo de descubrimiento de nodos locales con cero configuración, usando DNS de multidifusión. Ofrece un mecanismo para que los nodos en la misma red local se descubran entre sí sin configuración previa.
      \item \textbf{Circuit Relays}: Es un protocolo que facilita a los nodos el reenvío de tráfico en nombre de otros nodos que no tienen un acceso directo entre ellos\cite{CircuitRelay}.
      \item \textbf{rendezvous}: Un protocolo de encuentro que se utiliza como un punto común entre dos rutas.
            Los puntos de encuentro son típicamente nodos que están bien conectados y son estables en una red, y pueden manejar grandes cantidades de tráfico y datos. Sirven como un centro para que los nodos se descubran. De los pocos mecanismos centralizados que usa libp2p \cite{Rendezvous}.
      \item \textbf{pubsub}: Es una interfaz PubSub para libp2p, diseñada para establecer una base para la comunicación de mensajes mediante un patrón de publicación y suscripción entre los nodos de la red libp2p. Existen diferentes implementaciones de este protocolo, como FloodSub, GossipSub que proporcionan
            diferentes ventajas.
\end{itemize}

Como se ha comentado, libp2p ofrece varias formas de enrutamiento y descubrimiento de nodos, IPFS utiliza todas ellas en sus distintas
configuraciones. Depende del contexto la combinación de estos que se use.

\subsubsection{Mecanismo de intercambio de contenido}

\textbf{Bitswap:} Es un protocolo de intercambio de contenido que se ejecuta sobre una red P2P. Bitswap permite a los nodos intercambiar bloques de datos entre
sí. Los nodos pueden solicitar bloques de datos a otros nodos y compartir los bloques que disponen. Bitswap utiliza un mecanismo de intercambio de deuda para
garantizar que los nodos intercambien bloques de datos de manera justa y equitativa. Los nodos pueden intercambiar bloques de datos de manera eficiente, ya que
Bitswap mantiene un registro de los bloques que cada nodo tiene y los bloques que necesita.

La transferencia de datos (bloques) en IPFS está inspirada en BitTorrent, pero no es 100\% BitTorrent. Dos características de BitTorrent que utiliza IPFS:
\begin{itemize}[itemsep=1pt,nolistsep]
      \item Estrategia de tit-for-tat (el que no comparte no recibe).
      \item Obtén primero las piezas raras (mejora el rendimiento).
\end{itemize}
Una diferencia notable es que en BitTorrent cada archivo tiene un enjambre (también conocido como \textit{swarm}) separado de nodos (formando una red P2P entre ellos). En cambio IPFS es una única red de nodos formando un gran swarm. La variedad de BitTorrent en IPFS se llama Bitswap.

Bitswap es el algoritmo de intercambio de bloques, pero para realizar este intercambio primero se debe saber qué nodos pueden proveer los bloque que se buscan.
Esto es posible gracias a la DHT. En IPFS la DHT se utiliza principalmente con dos funciones:
% enumerated list with numbers
\begin{enumerate}
      \item \textbf{Enrutamiento:} se ha explicado en la subsección anterior.
      \item \textbf{Anuncios de provisión/consumición de contenido:} los nodos publican en la DHT los bloques de datos que tienen disponibles. Esto permite a otros nodos saber quién tiene los bloques de datos que están buscando. Esta tabla de hash se distribuye por la red mediante el algoritmo de Kademlia.
\end{enumerate}

Sobre el segundo, que es el concierne dentro del mecanismo de intercambio de contenido: Cada nodo tiene dos lista de bloques (CIDs). Bloques que posee y puede
proporcionar, y bloques que desea obtener.
\begin{itemize}[itemsep=1pt]
      \item Al recibir una lista de deseos, una entidad que use Bitswap debería procesarla eventualmente y responder al solicitante con información sobre el bloque o el bloque en sí.
      \item Al recibir bloques, el nodo consumidor debe enviar una notificación de cancelación al resto de nodos a los que ha pedido estos bloques, señalando que  ya no los desea.
\end{itemize}


\begin{figure}[H]
      \centering
      \includegraphics[width=0.8\textwidth]{images/bitswap.png}
      \caption{Protocolo Bitswap}
      \label{bitswap}
\end{figure}


\subsection{Modelo de datos}
% Explain the IPFS data model, which involves content addressing and hash-based naming.
% Discuss the benefits of the IPFS data model, such as data integrity, data verifiability, and content-based addressing.

El modelo de datos en IPFS está basado en árboles de Merkle. Es una estructura de datos en la que cada nodo es una representación hash de un conjunto de datos.
Los nodos hoja son representaciones (generalmente a través de una función de hash) de bloques de datos, mientras que cada nodo interno es la representación
(nuevamente, generalmente a través de una función de hash) de sus nodos hijos. Esto crea un sistema en el que cualquier cambio en los datos originales cambiará
los hashes en la ruta hasta la raíz del árbol, proporcionando una forma de verificar la integridad de los datos.

Un DAG de Merkle es una estructura donde cada nodo es un árbol de Merkle, y están conectados formando un grafo acíclico direccionado.
Esto significa que los nodos están conectados de tal manera que siempre hay una dirección (de nodos padres a nodos hijos) y no hay ciclos (no puedes empezar en un nodo, seguir las conexiones y volver al nodo original).

\begin{figure}[H]
      \centering
      \includegraphics[width=0.8\textwidth]{images/merkledag.png}
      \caption{Ejemplo de un árbol de Merkle}
      \label{merkledag}
\end{figure}

IPLD (InterPlanetary Linked Data)\cite{IPLDDocs} es un formato de datos basado en árboles de Merkle que permite enlazar datos entre diferentes sistemas distribuidos, como IPFS,
Bitcoin o Ethereum. Una estructura de datos inmutable es aquella que no puede ser modificada una vez creada, lo que ofrece ventajas como la seguridad, la
consistencia y la ausencia de efectos secundarios. IPLD utiliza estructuras de datos inmutables para representar los bloques de datos que se almacenan y se
enlazan entre sí mediante CIDs.

IPLD es una capa de abstracción que permite a los desarrolladores trabajar con datos en diferentes plataformas y protocolos como si estuvieran trabajando con un solo sistema cohesivo. Permite la interoperabilidad a gran escala entre diferentes sistemas de almacenamiento de datos, lo que facilita la creación de aplicaciones y servicios más robustos y resistentes en entornos distribuidos.

El DAG también garantiza a IPFS con característica de control de versiones como Git. Aunque este es un apartado en el que se profundiza poco en IPFS.
En el whitepaper, Benet se refiere más bien al hecho de que ambos al usar Merkle DAGs IPFS, posee características de control de versiones. Los nodos en un Merkle DAG son inmutables. Cualquier cambio en un nodo alteraría su identificador y, por lo tanto, afectaría a todos los ascendentes en el DAG, creando esencialmente un DAG diferente.

En lo que respecta a este trabajo este hecho permite la propia existencia de OrbitDB, el cual es una pieza clave en el desarrollo de este proyecto. OrbitDB implementa bases de datos distrubuidas en IPFS, se basa en este concepto al ser los datos inmutables y permitir la reconstrucción de la base de datos mediante el intercambio de objetos y la actualización de referencias remotas.
TODO poner referencia a orbitdb

Los códecs de IPLD son funciones que transforman el Modelo de Datos de IPLD en bytes serializados para que puedas enviar y compartir datos, y transforman los
bytes serializados de nuevo en el Modelo de Datos de IPLD para que puedas trabajar con él. Algunos de estos códecs incluyen:

\begin{itemize}[itemsep=1pt,nolistsep]
      \item \textbf{DAG-CBOR:} Un formato binario que soporta el Modelo de Datos de IPLD completo. Ofrece un excelente rendimiento y es adecuado para cualquier tipo de trabajo.
      \item \textbf{DAG-JSON:} Basado en JSON (Javascript Object Notation). Un formato legible por humanos que soporta casi el Modelo de Datos de IPLD completo. Es muy conveniente para la interoperabilidad, el desarrollo y la depuración.
      \item \textbf{DAG-PB:} Un formato binario para estructuras específicas limitadas de datos. Es ampliamente utilizado en IPFS y sobretodo en unixfsv1.
      \item \textbf{DAG-JOSE:} El codec dag-jose es un formato para firmar y cifrar objetos JSON.
\end{itemize}

En este proyecto se ha hecho especial incapié en el uso de DAG-JOSE como estructura de datos en el DAG de Merkle. Esto permite la firma y cifrado de los datos
en objetos JWS (JSON Web Signatures) y JWE (JSON Web Encryption) representados en nodos del dag de IPLD.
TODO poner referencia a la parte de JWE y JWS

Sobre todo este modelo de datos se establecen otras estructura o abstracciones como Unixfs.

Cuando se agrega un archivo a IPFS, puede que sea demasiado grande para caber en un solo bloque, por lo que se divide en disintos bloques que luego son
representados mediante metadatos en una lista de enlaces a estos bloques. UnixFS es un formato usado para describir archivos, directorios y enlaces simbólicos en
IPFS. Este formato de datos se usa para representar archivos y todos sus enlaces y metadatos en IPFS. UnixFS crea un bloque (o un árbol de bloques) de objetos enlazados.

\begin{minted}[fontsize=\small]{bash}
$ ipfs add Pictures/Wallpapers/ -r
added QmT4pCxAKwjKz58FRkKGZUkuk9dBogzvSqfKaP9aXxRsLh Wallpapers/flow 1.jpg
added QmY1KMKAoHmDK9V3woMGGarVUJ4a1a4HCW1CxRXMtC9KwP Wallpapers/flow 2.jpg

added QmYmdHatxVXfSy9Gjdp8e75cL2mvsGyZ1tT6Qo3ijUV2h5 Wallpapers
\end{minted}

Al obervar el contenido del CID final de la carpeta subida en el DAG

\begin{minted}[fontsize=\small]{bash}
$ ipfs dag get /ipfs/QmYmdHatxVXfSy9Gjdp8e75cL2mvsGyZ1tT6Qo3ijUV2h5 | jq
\end{minted}
\begin{minted}[fontsize=\small]{json}
{
  "Data": {
    "/": {
      "bytes": "CAE"
    }
  },
  "Links": [
      {
      "Hash": {
        "/": "QmT4pCxAKwjKz58FRkKGZUkuk9dBogzvSqfKaP9aXxRsLh"
      },
      "Name": "flow 1.jpg",
      "Tsize": 50087191
    },
    {
      "Hash": {
        "/": "QmVRXnTfUDxioWNZ5FbA79xuiZGtkUuxL6rae1MtstGuzu"
      },
      "Name": "flow 2.jpg",
      "Tsize": 32032025
    },
  ]
}
\end{minted}

Como se puede observar el DAG contiene la estructura de datos que modela un directorio, en este caso de tipo directorio.
\begin{minted}[fontsize=\small]{bash}
$ ipfs files stat /ipfs/QmYmdHatxVXfSy9Gjdp8e75cL2mvsGyZ1tT6Qo3ijUV2h5
Size: 0
CumulativeSize: 549538133
ChildBlocks: 22
Type: directory
\end{minted}

En cambio si se observa el contenido en el DAG de uno de los archivos enlazados:
\begin{minted}[fontsize=\small]{bash}
$ ipfs dag get QmT4pCxAKwjKz58FRkKGZUkuk9dBogzvSqfKaP9aXxRsLh | jq
{
  "Data": {
    "/": {
      "bytes": "CAIYnKzwFyCAgOAVIJyskAI"
    }
  },
  "Links": [
    {
      "Hash": {
        "/": "QmbhvAYKs4ERhnvujqDdTVCZdV2Y8UqrnFjGTVver1rzFL"
      },
      "Name": "",
      "Tsize": 45623854
    },
    {
      "Hash": {
        "/": "QmRw866oefrQ98iYb71cvKMmHTLsoTUW5j2cmRR5kkRqLf"
      },
      "Name": "",
      "Tsize": 4463228
    }
  ]
}
\end{minted}
El archivo ocupa dos bloques cuyos CIDs están en la lista de enlaces del objeto.
\begin{minted}[fontsize=\small]{bash}
$ ipfs files stat /ipfs/QmT4pCxAKwjKz58FRkKGZUkuk9dBogzvSqfKaP9aXxRsLh
QmT4pCxAKwjKz58FRkKGZUkuk9dBogzvSqfKaP9aXxRsLh
Size: 50075164
CumulativeSize: 50087191
ChildBlocks: 2
Type: fil
\end{minted}


Sobre Unixfs existe otra capa más que es la que realmente permite una interacción con IPFS como si de un
sistema de ficheros tradicional se tratara. Este componente es denominado \textit{Mutable File System} (MFS) o Sistema de Archivos Mutable.
Para hacer esto posible, MFS mantiene un mapa de la estructura de archivos y directorios en IPFS. Cada vez que se realiza una operación en MFS, como crear o mover
un archivo, se actualiza este mapa. Sin embargo, los datos subyacentes en IPFS permanecen inalterados. Esto significa que se pueden cambiar la estructura y
organización de archivos y directorios en MFS sin tener que copiar o mover los datos reales, manipulando enlaces dentro del DAG.
\begin{figure}[H]
      \vspace{10pt}
      \centering
      \begin{tikzpicture}[node distance = 0.5cm, auto]
            % Estilos
            \tikzstyle{block} = [rectangle, draw, fill=blue!20,
            text width=5cm, text centered, rounded corners, minimum height=1cm]

            \node [block] (mfs) {MFS \\ Sistema de archivos};
            \node [block, below = of mfs] (unixfs) {UnixFS \\ Archivos y directorios};
            \node [block, below = of unixfs] (dag) {DAG \\ Nodos};
            \node [block, below = of dag] (block) {Bloque \\ Flujo de bits};

            \draw (mfs) -- (unixfs);
            \draw (unixfs) -- (dag);
            \draw (dag) -- (block);
      \end{tikzpicture}
      \caption{Capas de abstracción sobre los datos en IPFS}
      \label{fig:modelo-datos-ipfs}
\end{figure}


\subsection{Sistema de nombres}


IPNS, o Sistema de Nombres Interplanetario, es un componente fundamental de IPFS que permite la creación de nombres persistentes para diferentes
nodos en la red IPFS. Dado que los contenidos en IPFS son inmutables y se accede a ellos a través de sus CIDs,
cualquier cambio en el contenido dará lugar a un nuevo CID. Esto puede resultar inconveniente para los usuarios que necesitan referirse a un contenido
específico, incluso si este cambia con el tiempo. Aquí es donde entra en juego IPNS.

IPNS proporciona una capa de indirección que permite a los usuarios referirse a contenidos que pueden cambiar con el tiempo usando un nombre persistente.
En lugar de tener que actualizar el CID cada vez que cambia el contenido, los usuarios pueden referirse al contenido usando un identificador IPNS.
Este identificador es una clave criptográfica que se genera cuando se inicializa un nodo IPFS, y es única para cada nodo.

Cuando se desea publicar contenido bajo IPNS, se crea un registro que vincula el identificador IPNS con el CID del contenido.
Este registro se firma con la clave privada del nodo, garantizando que solo el propietario del identificador IPNS puede cambiar la vinculación.
El registro se propaga luego a través de la red IPFS usando un protocolo de tablas hash distribuidas. Cuando otros nodos quieren acceder al contenido, pueden buscar el registro usando el identificador IPNS y obtener el CID correspondiente.

IPNS es de interés particular para este proyecto debido a que permite crear enlaces persistentes a contenido que puede cambiar con el tiempo.
Tal y como sucede con una URL a un enlace a un contenido compartido en plataformas de almacenamiento en la nube como Google Drive o Dropbox.

Este es el último apartado en esta explicación de los fundamentos de IPFS. Por supuesto, no se ha cubierto todo lo que IPFS ofrece, pero si los conceptos
fundamentales necesarios para entender el sistema que se propone en el proyecto.

\section{Ecosistema en torno a IPFS}\label{sect:ecosistema}
\subsection{Introducción}
El ecosistema IPFS es un conjunto diverso y creciente de proyectos, herramientas, comunidades e integraciones que trabajan colectivamente para desarrollar, adoptar y evolucionar IPFS. Este ecosistema es fundamental para el éxito y la adopción generalizada de IPFS, ya que proporciona una variedad de recursos y oportunidades para interactuar y construir sobre IPFS.

\subsection{Proyectos basados en IPFS}
Existen numerosos proyectos y productos que se basan en IPFS para ofrecer soluciones innovadoras y disruptivas en diferentes áreas de aplicación. Algunas de estas áreas son:
\begin{itemize}
      \item Almacenamiento: proyectos que utilizan IPFS para proporcionar servicios de almacenamiento distribuido, persistente y rentable, como Filecoin, Sia, Storj o Textile.
      \item Alojamiento web: proyectos que utilizan IPFS para alojar sitios web estáticos o dinámicos sin depender de servidores centralizados, como Fleek, Pinata o Unstoppable Domains.
      \item Distribución de contenido: proyectos que utilizan IPFS para distribuir contenido multimedia, educativo o informativo de forma eficiente y descentralizada, como Audius, Wikipedia Mirror o Origin Protocol.
      \item Aplicaciones descentralizadas (dApps): proyectos que utilizan IPFS para construir aplicaciones web que funcionan sobre redes peer-to-peer, sin intermediarios ni puntos de fallo, como Brave, Metamask o OpenBazaar.

\end{itemize}
\subsection{Herramientas y librerías de IPFS}
Existen diversas herramientas y librerías que facilitan el desarrollo y la integración con IPFS, tanto para usuarios finales como para desarrolladores.
Algunas de estas herramientas y librerías son:
\begin{itemize}
      \item Clientes API: herramientas que permiten interactuar con un nodo IPFS a través de una interfaz de programación de aplicaciones (API), como ipfs-http-client, ipfs-js or py-ipfs-http-client.
      \item Interfaces de línea de comandos: herramientas que permiten interactuar con un nodo IPFS a través de una terminal o consola, como ipfs or ipfs-cluster.
      \item Marcos de desarrollo: herramientas que facilitan la creación y el despliegue de aplicaciones basadas en IPFS, como Fleek, Textile or 3Box.
      \item Librerías para integrar IPFS: herramientas que permiten integrar IPFS en otras aplicaciones o plataformas, como ipfs-embed, js-ipfs or go-ipfs.

\end{itemize}
\subsection{Comunidades en torno a IPFS}
Existen diversas comunidades que se forman alrededor de IPFS, tanto para apoyar el desarrollo y la adopción del proyecto, como para explorar sus posibilidades y beneficios.
Algunas de estas comunidades son:
\begin{itemize}
      \item Comunidades de desarrolladores: comunidades que se dedican a contribuir al código fuente, a reportar errores, a proponer mejoras o a crear nuevas funcionalidades para IPFS, como el equipo principal de IPFS, los colaboradores externos o los grupos locales.
      \item Comunidades de usuarios: comunidades que se dedican a utilizar IPFS para sus propios fines, a compartir experiencias, a resolver dudas o a dar feedback sobre el proyecto, como los usuarios finales, los creadores de contenido o los operadores de nodos.
      \item Comunidades de gobernancia: comunidades que se dedican a definir las reglas, los principios y los objetivos del proyecto IPFS, así como a coordinar las acciones y los recursos necesarios para su cumplimiento, como el Protocol Labs, la Fundación Filecoin o el Consejo Asesor.
\end{itemize}
\subsection{Integraciones de IPFS}
Existen diversas formas en las que IPFS se integra con otras tecnologías y plataformas para ampliar sus capacidades y su alcance.
Algunas de estas integraciones son:
\begin{itemize}
      \item Ethereum: una plataforma de computación descentralizada que permite la creación de contratos inteligentes y aplicaciones descentralizadas. IPFS se integra con Ethereum para almacenar y distribuir los datos asociados a estas aplicaciones, así como para mejorar la escalabilidad y la eficiencia de la red.
      \item Filecoin: una red de almacenamiento descentralizado que permite a los usuarios alquilar o proveer espacio de disco a cambio de una criptomoneda. IPFS se integra con Filecoin para ofrecer una capa de incentivos económicos y una garantía de disponibilidad y persistencia de los datos almacenados en IPFS.
\end{itemize}

Como se puede apreciar IPFS es un proyecto con una gran comunidad y un ecosistema muy activo. Dada su naturaleza IPFS
es un proyecto que se puede integrar en cantidad de ámbitos y tecnologías, ofreciendo las ventajas ya previamente mencionadas.